<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mummuu's Dashboard</title>
    <link rel="icon" type="image/png" href="icon.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet"> <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- VARIABLES --- */
        :root {
            --bg-gradient: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --accent: #ff4d6d;
            --text-main: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        /* --- IDENTITY MODAL --- */
        .identity-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .identity-box {
            background: #1a1a2e; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid var(--accent);
        }
        .id-btn {
            padding: 10px 20px; margin: 10px; font-size: 1.2rem; border-radius: 10px; border: none; cursor: pointer;
            background: rgba(255,255,255,0.1); color: white; transition: 0.3s;
        }
        .id-btn:hover { background: var(--accent); }

        /* --- HEADER --- */
        header { text-align: center; padding: 30px 20px 10px; position: relative; }
        .names-container { 
            display: flex; justify-content: space-between; align-items: center; 
            max-width: 350px; margin: 0 auto; 
            /* NEW FONT HERE */
            font-family: 'Pacifico', cursive; 
            font-size: 1.5rem; color: var(--accent);
            text-shadow: 0 0 10px rgba(255, 77, 109, 0.6);
        }
        .constellation-canvas {
            position: absolute; top: 40px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 20px; opacity: 0.5; pointer-events: none;
        }
        .infinite-timer { margin-top: 20px; }
        .timer-digits { font-family: 'Courier New', monospace; font-size: 1rem; opacity: 0.8; }

        /* --- GRID --- */
        .grid-container {
            display: grid; grid-template-columns: 1fr; gap: 15px;
            max-width: 600px; margin: 20px auto; padding: 0 15px;
        }
        @media (min-width: 600px) { .grid-container { grid-template-columns: 1fr 1fr; } .span-2 { grid-column: span 2; } }

        .card {
            background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 20px; backdrop-filter: blur(10px);
        }
        .card-title { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; margin-bottom: 15px; }

        /* --- MOOD --- */
        .mood-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .mood-btn {
            background: rgba(255,255,255,0.1); border: none; border-radius: 50%;
            width: 35px; height: 35px; cursor: pointer; font-size: 1.1rem; transition: 0.2s;
        }
        .mood-btn.active { background: var(--accent); transform: scale(1.1); box-shadow: 0 0 10px var(--accent); }
        
        /* LOCKED STATE (Greyed out) */
        .locked-row { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }

        /* --- FOCUS --- */
        .focus-item { margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px; }
        .focus-who { font-size: 0.7rem; color: var(--accent); font-weight: bold; }
        .focus-what { font-size: 1rem; font-weight: 600; }
        .focus-days { font-size: 0.8rem; opacity: 0.7; }

        /* --- TIMELINE --- */
        .timeline-scroll { max-height: 150px; overflow-y: auto; }
        .timeline-event { display: flex; gap: 10px; margin-bottom: 15px; }
        .event-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; margin-top: 6px; flex-shrink: 0; }
        .event-date { font-size: 0.8rem; font-weight: bold; color: var(--accent); }
        .event-desc { font-size: 0.8rem; opacity: 0.8; }

        /* --- CORNER ELEMENTS --- */
        .pulse-container { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
        .pulse-btn {
            width: 60px; height: 60px; border-radius: 50%; background: rgba(255, 77, 109, 0.2); 
            border: 2px solid var(--accent); color: var(--accent); font-size: 1.5rem; cursor: pointer;
        }
        .cat-container { position: fixed; bottom: 10px; left: 10px; z-index: 100; pointer-events: none; }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: twinkle var(--duration) infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

    </style>
</head>
<body>

    <div id="identity-modal" class="identity-overlay" style="display:none;">
        <div class="identity-box">
            <h2 style="margin-bottom:20px;">Who is this?</h2>
            <button class="id-btn" onclick="setIdentity('bubu')">üêª Bubu</button>
            <button class="id-btn" onclick="setIdentity('mumu')">üê± Mumu</button>
        </div>
    </div>

    <div class="stars" id="star-container"></div>

    <header>
        <div class="names-container">
            <span>BUBU</span>
            <span>MUMU</span>
        </div>
        <canvas class="constellation-canvas" id="constellation"></canvas>
        <div class="infinite-timer">
            <div class="timer-digits" id="timer-display">Loading love...</div>
        </div>
    </header>

    <div class="grid-container">

        <div class="card span-2">
            <div class="card-title">Mood Station</div>
            
            <div style="font-size:0.7rem; margin-bottom:5px;">Bubu is feeling:</div>
            <div class="mood-row" id="mood-row-bubu">
                <button class="mood-btn" onclick="setMood('bubu', 'üòä')">üòä</button>
                <button class="mood-btn" onclick="setMood('bubu', 'üòî')">üòî</button>
                <button class="mood-btn" onclick="setMood('bubu', 'üò¥')">üò¥</button>
                <button class="mood-btn" onclick="setMood('bubu', '‚ù§Ô∏è')">‚ù§Ô∏è</button>
            </div>

            <div style="font-size:0.7rem; margin-bottom:5px;">Mumu is feeling:</div>
            <div class="mood-row" id="mood-row-mumu">
                <button class="mood-btn" onclick="setMood('mumu', 'üòä')">üòä</button>
                <button class="mood-btn" onclick="setMood('mumu', 'üòî')">üòî</button>
                <button class="mood-btn" onclick="setMood('mumu', 'üò¥')">üò¥</button>
                <button class="mood-btn" onclick="setMood('mumu', '‚ù§Ô∏è')">‚ù§Ô∏è</button>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Current Focus</div>
            <div class="focus-item">
                <div class="focus-who">BUBU'S MISSION</div>
                <div class="focus-what" id="focus-bubu-text">...</div>
                <div class="focus-days" id="focus-bubu-days">...</div>
            </div>
            <div class="focus-item">
                <div class="focus-who">MUMU'S MISSION</div>
                <div class="focus-what" id="focus-mumu-text">...</div>
                <div class="focus-days" id="focus-mumu-days">...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Our Story</div>
            <div class="timeline-scroll" id="timeline-container">
                </div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span>Memory Box</span>
                <button onclick="shuffleMemory()" style="background:none; border:1px solid #fff; color:#fff; border-radius:10px; padding:2px 8px; cursor:pointer;">‚Üª</button>
            </div>
            <div id="memory-text" style="font-style:italic; min-height:50px; display:flex; align-items:center; justify-content:center;">
                "Loading memories..."
            </div>
        </div>

    </div>

    <div class="cat-container">
        <lottie-player src="cat.json" background="transparent" speed="1" style="width: 120px; height: 120px;" loop autoplay></lottie-player>
    </div>
    <div class="pulse-container">
        <button class="pulse-btn" id="pulseBtn">‚ù§Ô∏è</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBznon9j3zMoqT24mWZci29cfGGw41bT-U",
            authDomain: "st-pro-fd169.firebaseapp.com",
            databaseURL: "https://st-pro-fd169-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "st-pro-fd169",
            storageBucket: "st-pro-fd169.firebasestorage.app",
            messagingSenderId: "197475448314",
            appId: "1:197475448314:web:80500f982485c10bf32043"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- IDENTITY SYSTEM ---
        const modal = document.getElementById('identity-modal');
        const userRole = localStorage.getItem('user_role');

        if (!userRole) {
            modal.style.display = 'flex'; // Show if no role saved
        } else {
            applyLocks(userRole);
        }

        window.setIdentity = function(role) {
            localStorage.setItem('user_role', role);
            modal.style.display = 'none';
            applyLocks(role);
        }

        function applyLocks(role) {
            // If I am Bubu, Lock Mumu's row
            if (role === 'bubu') {
                document.getElementById('mood-row-mumu').classList.add('locked-row');
            } 
            // If I am Mumu, Lock Bubu's row
            else if (role === 'mumu') {
                document.getElementById('mood-row-bubu').classList.add('locked-row');
            }
        }

        // --- MOODS ---
        window.setMood = function(person, mood) {
            set(ref(db, `moods/${person}`), mood);
        }
        onValue(ref(db, 'moods'), (snap) => {
            const data = snap.val() || {};
            // Update UI
            document.querySelectorAll('#mood-row-bubu .mood-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === data.bubu));
            document.querySelectorAll('#mood-row-mumu .mood-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === data.mumu));
        });

        // --- FOCUS TRACKER (Read from DB) ---
        onValue(ref(db, 'focus'), (snap) => {
            const data = snap.val() || {};
            
            // Bubu
            document.getElementById('focus-bubu-text').innerText = data.bubuText || "No Mission";
            if(data.bubuDate) {
                const days = Math.ceil((new Date(data.bubuDate) - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('focus-bubu-days').innerText = days > 0 ? `${days} days left` : "Completed";
            }

            // Mumu
            document.getElementById('focus-mumu-text').innerText = data.mumuText || "No Mission";
            if(data.mumuDate) {
                const days = Math.ceil((new Date(data.mumuDate) - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('focus-mumu-days').innerText = days > 0 ? `${days} days left` : "Completed";
            }
        });

        // --- TIMELINE (Read from DB) ---
        onValue(ref(db, 'timeline'), (snap) => {
            const list = document.getElementById('timeline-container');
            list.innerHTML = "";
            const events = snap.val() || {};
            
            // Sort by date key (YYYY-MM-DD)
            Object.keys(events).sort().forEach(key => {
                const evt = events[key];
                const div = document.createElement('div');
                div.className = 'timeline-event';
                div.innerHTML = `
                    <div class="event-dot"></div>
                    <div>
                        <div class="event-date">${evt.date}</div>
                        <div class="event-desc">${evt.title}</div>
                    </div>
                `;
                list.appendChild(div);
            });
        });

        // --- MEMORY BOX (Read from DB) ---
        let memoryList = ["Loading..."];
        onValue(ref(db, 'memories'), (snap) => {
            if(snap.exists()) memoryList = Object.values(snap.val());
            else memoryList = ["No memories added yet!"];
            shuffleMemory();
        });

        window.shuffleMemory = function() {
            const random = memoryList[Math.floor(Math.random() * memoryList.length)];
            document.getElementById('memory-text').innerText = `"${random}"`;
        }

        // --- PULSE ---
        document.getElementById("pulseBtn").addEventListener("click", () => {
            set(ref(db, 'heartbeats/lastPulse'), Date.now());
        });
        onValue(ref(db, 'heartbeats/lastPulse'), (snapshot) => {
            if (snapshot.exists() && Date.now() - snapshot.val() < 2000) {
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.9 }, colors: ['#ff4d6d', '#ffffff'] });
            }
        });

    </script>

    <script>
        // STARS
        const starsContainer = document.getElementById('star-container');
        for(let i=0; i<50; i++) {
            let star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.width = Math.random() * 2 + 'px';
            star.style.height = star.style.width;
            star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
            starsContainer.appendChild(star);
        }

        // TIMER
        const startDate = new Date("2025-10-21T00:00:00");
        setInterval(() => {
            const now = new Date();
            const diff = now - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            document.getElementById('timer-display').innerText = `${days} Days, ${hours}h ${minutes}m ${seconds}s`;
        }, 1000);

        // CONSTELLATION LINE
        const canvas = document.getElementById('constellation');
        const ctx = canvas.getContext('2d');
        let width, height;
        function resize() { width = canvas.width = canvas.offsetWidth; height = canvas.height = canvas.offsetHeight; }
        window.addEventListener('resize', resize); resize();
        
        let particleX = 0;
        function animate() {
            ctx.clearRect(0, 0, width, height);
            ctx.beginPath(); ctx.moveTo(0, height/2); ctx.lineTo(width, height/2);
            ctx.strokeStyle = "rgba(255, 77, 109, 0.3)"; ctx.lineWidth = 1; ctx.stroke();
            
            ctx.beginPath(); ctx.arc(particleX, height/2, 3, 0, Math.PI*2);
            ctx.fillStyle = "#ff4d6d"; ctx.fill();
            particleX += 1; if (particleX > width) particleX = 0;
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
